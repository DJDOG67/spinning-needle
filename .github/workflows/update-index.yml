name: ğŸ” Update index.json in magazines

on:
  push:
    paths:
      - 'magazines/*.json'

jobs:
  generate-index:
    runs-on: ubuntu-latest

    steps:
    - name: ğŸ“¥ Checkout repository
      uses: actions/checkout@v3

    - name: ğŸ§¾ Generate index.json
      run: |
        cd magazines
        ls *.json | grep -v index.json | jq -R . | jq -s . > index.json

    - name: ğŸ” Commit and push index.json
      run: |
        git config --global user.email "bot@spinningneedle.io"
        git config --global user.name "Spinning Needle Bot"
        git add magazines/index.json
        git commit -m "ğŸ” Auto-update index.json [CI]"
        git push
